<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>弧形</title>
</head>
<body>
<canvas id="canvasid"></canvas>

<script>

    (function () {
        var canvas = document.querySelector("#canvasid");
        canvas.width= 600;
        canvas.height =600;
        canvas.style.border = "1px solid black";
        var cxt = canvas.getContext("2d");
        cxt.beginPath();
//        cxt.moveTo(200,200);
//        cxt.arc(200,200,200,0,30*Math.PI/180,true);
//        cxt.closePath();
//
//        cxt.fillStyle = "red";
//        cxt.fill();
//        cxt.stroke();


        var data = [{
            "value": .2,
            "color": "red",
            "title": "应届生"
        },{
            "value": .3,
            "color": "blue",
            "title": "社会招生"
        },{
            "value": .4,
            "color": "green",
            "title": "老学员推荐"
        },{
            "value": .1,
            "color": "#ccc",
            "title": "公开课"
        }];

        var startAngle = -90;
        var x = 200;
        var y = 200;
        var r = 100;
        console.log(startAngle);

        for(var i = 0 ; i <data.length; i++){
            cxt.beginPath();

            var angle = data[i].value*360;
            console.log(angle);
            var tmpAngle = (startAngle + angle);
            console.log(startAngle + ","+tmpAngle+"-----");

            cxt.moveTo(x,y);
            cxt.arc(x,y,r,startAngle*Math.PI/180,tmpAngle*Math.PI/180,false);

             var textAgle = startAngle+angle/2;
            console.log("文本角度:"+textAgle);

            startAngle = tmpAngle;

            var textValue = data[i].value * 100 + "%";
            var x1 = x + Math.cos(textAgle*Math.PI/180)*(r+20);
            var y1 = y + Math.sin(textAgle*Math.PI/180)*(r+20);

            console.log("开始:"+startAngle);

            cxt.fillStyle = data[i].color;

            if(textAgle >90 && textAgle < 270){
                cxt.textAlign = "end";
            }

            cxt.fillText(textValue,x1,y1);





            cxt.closePath();
//            cxt.stroke();

            cxt.fill();





        }

    }());


</script>
</body>
</html>